<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒì„¸ í˜ì´ì§€</title>
    <link rel = "stylesheet" href = "/main.css">
</head>
<body class = "grey-bg">
    <%- include('nav.ejs') %>
    
    <div class="detail-bg">
        <div class="chat-screen">
            <div class="chat-box">
                <span>ğŸ‘¤<b><%-mainuser.writer%></b></span>
                <span>ì•ˆë…•í•˜ì„¸ìš”</span>
            </div>
            <div class="chat-box">
                <span>ğŸ‘¤<b><%-mainuser.writer%></b></span>
                <span>ì•ˆë…•í•˜ì„¸ìš”</span>
            </div>
            <div class="chat-box mine">
                <span>ì•ˆë…•í•˜ì„¸ìš”</span>
                <span><b><%-subuser.username%></b>ğŸ‘¤</span>
            </div>
        </div>
      </div>
      <div class="chat-form">
        <input class="chat-input">
        <button class="chat-button">ì „ì†¡</button>
  </div> 
    
    
    <script src="https://cdn.jsdelivr.net/npm/socket.io@4.7.2/client-dist/socket.io.min.js"></script>  
    <script>
        const socket = io() 
        socket.emit('ask-join','<%-chatrooms%._id>')

        document.querySelector(".chat-button").addEventListener('click',
        function(){
            let chatmsg = document.querySelector('.chat-input').value
            socket.emit('message',{ msg : chatmsg , room :'<%-chatrooms%._id>' })
        })
        
        socket.on('broadmsg',(msg)=>{
            documemt.querySelector('.chat-screen').insertAdjacentHTML('beforeend',
            `<div class="chat-box">
                <span>ğŸ‘¤<b><%-mainuser.writer%></b></span>
                <span>${msg}</span>
            </div>`
          )
        })
    </script>
</body>
</html>